<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Fun chemistry games to test your knowledge">
    <title>Chemistry Games - SBS Tools</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/mobile.css">
    <link rel="stylesheet" href="../../assets/css/tool-page.css">

    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
</head>

<body>
    <div id="navbar-container"></div>
    <script type="module" src="../../assets/js/navbar.js"></script>

    <main class="tool-page">
        <div class="tool-container">
            <div class="tool-header">
                <h1><i data-lucide="gamepad-2"></i> Chemistry Games</h1>
                <p>Test your chemistry knowledge with fun games!</p>
            </div>

            <div class="games-grid">
                <div class="game-card" onclick="startGame('elements')">
                    <div class="game-icon"><i data-lucide="atom"></i></div>
                    <h3>Element Quiz</h3>
                    <p>Guess elements from their symbols or atomic numbers</p>
                    <span class="game-badge">Quick Play</span>
                </div>
                <div class="game-card" onclick="startGame('formulas')">
                    <div class="game-icon"><i data-lucide="flask-conical"></i></div>
                    <h3>Formula Master</h3>
                    <p>Match chemical formulas to compound names</p>
                    <span class="game-badge">Challenge</span>
                </div>
                <div class="game-card" onclick="startGame('balance')">
                    <div class="game-icon"><i data-lucide="scale"></i></div>
                    <h3>Balance Blitz</h3>
                    <p>Balance chemical equations against the clock</p>
                    <span class="game-badge">Timed</span>
                </div>
            </div>

            <!-- Game Container -->
            <div class="tool-card game-container" id="game-container" style="display: none;">
                <div class="game-header">
                    <div class="game-info">
                        <span id="game-title">Element Quiz</span>
                        <span class="game-stats">
                            Score: <span id="score">0</span> |
                            Question: <span id="question-num">1</span>/10
                        </span>
                    </div>
                    <button class="tool-btn tool-btn-secondary" onclick="endGame()">
                        <i data-lucide="x"></i> Exit
                    </button>
                </div>

                <div class="game-content" id="game-content">
                    <!-- Game content loaded dynamically -->
                </div>

                <div class="game-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="game-progress" style="width: 10%"></div>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div class="tool-card" id="results-container" style="display: none;">
                <div class="results-content">
                    <div class="results-icon" id="results-icon">üéâ</div>
                    <h2 id="results-title">Great Job!</h2>
                    <div class="final-score">
                        <span class="score-label">Final Score</span>
                        <span class="score-value" id="final-score">0/10</span>
                    </div>
                    <p id="results-message">You're a chemistry expert!</p>
                    <div class="btn-group">
                        <button class="tool-btn tool-btn-primary" onclick="playAgain()">
                            <i data-lucide="rotate-ccw"></i> Play Again
                        </button>
                        <button class="tool-btn tool-btn-secondary" onclick="backToGames()">
                            <i data-lucide="grid"></i> More Games
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <style>
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .game-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 40px rgba(6, 182, 212, 0.2);
        }

        .game-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 20px;
        }

        .game-icon svg {
            width: 40px;
            height: 40px;
            color: var(--accent-color);
        }

        .game-card h3 {
            margin: 0 0 0.5rem;
            font-size: 1.3rem;
        }

        .game-card p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .game-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.3rem 0.8rem;
            background: var(--accent-color);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .game-container {
            padding: 0;
            overflow: hidden;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .game-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        #game-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .game-stats {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .game-content {
            padding: 2rem;
            min-height: 300px;
        }

        .game-progress {
            padding: 0 1.5rem 1.5rem;
        }

        .question-text {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .question-text .highlight {
            color: var(--accent-color);
            font-size: 2rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .option-btn {
            padding: 1.25rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .option-btn:hover {
            border-color: var(--accent-color);
        }

        .option-btn.correct {
            background: rgba(56, 217, 169, 0.2);
            border-color: #38d9a9;
            color: #38d9a9;
        }

        .option-btn.incorrect {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .results-content {
            text-align: center;
            padding: 2rem;
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .results-content h2 {
            margin: 0 0 1.5rem;
            font-size: 2rem;
        }

        .final-score {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .score-label {
            color: var(--text-secondary);
        }

        .score-value {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .results-content p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .question-text .highlight {
                font-size: 1.5rem;
            }
        }
    </style>

    <script>
        // Element data
        const elements = [
            { symbol: 'H', name: 'Hydrogen', number: 1 },
            { symbol: 'He', name: 'Helium', number: 2 },
            { symbol: 'Li', name: 'Lithium', number: 3 },
            { symbol: 'Be', name: 'Beryllium', number: 4 },
            { symbol: 'B', name: 'Boron', number: 5 },
            { symbol: 'C', name: 'Carbon', number: 6 },
            { symbol: 'N', name: 'Nitrogen', number: 7 },
            { symbol: 'O', name: 'Oxygen', number: 8 },
            { symbol: 'F', name: 'Fluorine', number: 9 },
            { symbol: 'Ne', name: 'Neon', number: 10 },
            { symbol: 'Na', name: 'Sodium', number: 11 },
            { symbol: 'Mg', name: 'Magnesium', number: 12 },
            { symbol: 'Al', name: 'Aluminum', number: 13 },
            { symbol: 'Si', name: 'Silicon', number: 14 },
            { symbol: 'P', name: 'Phosphorus', number: 15 },
            { symbol: 'S', name: 'Sulfur', number: 16 },
            { symbol: 'Cl', name: 'Chlorine', number: 17 },
            { symbol: 'Ar', name: 'Argon', number: 18 },
            { symbol: 'K', name: 'Potassium', number: 19 },
            { symbol: 'Ca', name: 'Calcium', number: 20 },
            { symbol: 'Fe', name: 'Iron', number: 26 },
            { symbol: 'Cu', name: 'Copper', number: 29 },
            { symbol: 'Zn', name: 'Zinc', number: 30 },
            { symbol: 'Ag', name: 'Silver', number: 47 },
            { symbol: 'Au', name: 'Gold', number: 79 },
            { symbol: 'Pb', name: 'Lead', number: 82 },
            { symbol: 'U', name: 'Uranium', number: 92 }
        ];

        const compounds = [
            { formula: 'H‚ÇÇO', name: 'Water' },
            { formula: 'NaCl', name: 'Sodium Chloride' },
            { formula: 'CO‚ÇÇ', name: 'Carbon Dioxide' },
            { formula: 'H‚ÇÇSO‚ÇÑ', name: 'Sulfuric Acid' },
            { formula: 'NaOH', name: 'Sodium Hydroxide' },
            { formula: 'HCl', name: 'Hydrochloric Acid' },
            { formula: 'NH‚ÇÉ', name: 'Ammonia' },
            { formula: 'CH‚ÇÑ', name: 'Methane' },
            { formula: 'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ', name: 'Glucose' },
            { formula: 'CaCO‚ÇÉ', name: 'Calcium Carbonate' },
            { formula: 'C‚ÇÇH‚ÇÖOH', name: 'Ethanol' },
            { formula: 'HNO‚ÇÉ', name: 'Nitric Acid' },
            { formula: 'H‚ÇÉPO‚ÇÑ', name: 'Phosphoric Acid' },
            { formula: 'KMnO‚ÇÑ', name: 'Potassium Permanganate' },
            { formula: 'Na‚ÇÇCO‚ÇÉ', name: 'Sodium Carbonate' }
        ];

        const balanceQuestions = [
            { unbalanced: 'H‚ÇÇ + O‚ÇÇ ‚Üí H‚ÇÇO', answers: ['2', '1', '2'], display: '_H‚ÇÇ + _O‚ÇÇ ‚Üí _H‚ÇÇO' },
            { unbalanced: 'Fe + O‚ÇÇ ‚Üí Fe‚ÇÇO‚ÇÉ', answers: ['4', '3', '2'], display: '_Fe + _O‚ÇÇ ‚Üí _Fe‚ÇÇO‚ÇÉ' },
            { unbalanced: 'N‚ÇÇ + H‚ÇÇ ‚Üí NH‚ÇÉ', answers: ['1', '3', '2'], display: '_N‚ÇÇ + _H‚ÇÇ ‚Üí _NH‚ÇÉ' },
            { unbalanced: 'CH‚ÇÑ + O‚ÇÇ ‚Üí CO‚ÇÇ + H‚ÇÇO', answers: ['1', '2', '1', '2'], display: '_CH‚ÇÑ + _O‚ÇÇ ‚Üí _CO‚ÇÇ + _H‚ÇÇO' },
            { unbalanced: 'Na + Cl‚ÇÇ ‚Üí NaCl', answers: ['2', '1', '2'], display: '_Na + _Cl‚ÇÇ ‚Üí _NaCl' }
        ];

        let currentGame = null;
        let score = 0;
        let questionNum = 0;
        let totalQuestions = 10;
        let questions = [];

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        function startGame(type) {
            currentGame = type;
            score = 0;
            questionNum = 0;
            questions = generateQuestions(type);

            document.querySelector('.games-grid').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';

            const titles = {
                'elements': 'Element Quiz',
                'formulas': 'Formula Master',
                'balance': 'Balance Blitz'
            };
            document.getElementById('game-title').textContent = titles[type];

            nextQuestion();
            lucide.createIcons();
        }

        function generateQuestions(type) {
            const qs = [];
            if (type === 'elements') {
                const shuffled = [...elements].sort(() => Math.random() - 0.5);
                for (let i = 0; i < Math.min(totalQuestions, shuffled.length); i++) {
                    const el = shuffled[i];
                    const questionType = Math.random() > 0.5 ? 'symbol' : 'number';
                    const wrongAnswers = elements
                        .filter(e => e.symbol !== el.symbol)
                        .sort(() => Math.random() - 0.5)
                        .slice(0, 3)
                        .map(e => e.name);

                    qs.push({
                        question: questionType === 'symbol'
                            ? `What element has the symbol <span class="highlight">${el.symbol}</span>?`
                            : `What element has atomic number <span class="highlight">${el.number}</span>?`,
                        correct: el.name,
                        options: [el.name, ...wrongAnswers].sort(() => Math.random() - 0.5)
                    });
                }
            } else if (type === 'formulas') {
                const shuffled = [...compounds].sort(() => Math.random() - 0.5);
                for (let i = 0; i < Math.min(totalQuestions, shuffled.length); i++) {
                    const comp = shuffled[i];
                    const questionType = Math.random() > 0.5 ? 'formula' : 'name';

                    if (questionType === 'formula') {
                        const wrongAnswers = compounds
                            .filter(c => c.formula !== comp.formula)
                            .sort(() => Math.random() - 0.5)
                            .slice(0, 3)
                            .map(c => c.name);

                        qs.push({
                            question: `What is the name of <span class="highlight">${comp.formula}</span>?`,
                            correct: comp.name,
                            options: [comp.name, ...wrongAnswers].sort(() => Math.random() - 0.5)
                        });
                    } else {
                        const wrongAnswers = compounds
                            .filter(c => c.formula !== comp.formula)
                            .sort(() => Math.random() - 0.5)
                            .slice(0, 3)
                            .map(c => c.formula);

                        qs.push({
                            question: `What is the formula for <span class="highlight">${comp.name}</span>?`,
                            correct: comp.formula,
                            options: [comp.formula, ...wrongAnswers].sort(() => Math.random() - 0.5)
                        });
                    }
                }
            } else if (type === 'balance') {
                const shuffled = [...balanceQuestions].sort(() => Math.random() - 0.5);
                for (let i = 0; i < Math.min(totalQuestions, shuffled.length); i++) {
                    const bq = shuffled[i % shuffled.length];
                    const correctAnswer = bq.answers.join(', ');
                    const wrongAnswers = generateWrongCoefficients(bq.answers.length);

                    qs.push({
                        question: `Balance: <span class="highlight">${bq.display}</span>`,
                        correct: correctAnswer,
                        options: [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5)
                    });
                }
            }
            return qs;
        }

        function generateWrongCoefficients(length) {
            const wrong = [];
            for (let i = 0; i < 3; i++) {
                const coeffs = [];
                for (let j = 0; j < length; j++) {
                    coeffs.push(Math.floor(Math.random() * 5) + 1);
                }
                wrong.push(coeffs.join(', '));
            }
            return wrong;
        }

        function nextQuestion() {
            if (questionNum >= questions.length) {
                showResults();
                return;
            }

            const q = questions[questionNum];
            document.getElementById('question-num').textContent = questionNum + 1;
            document.getElementById('game-progress').style.width = ((questionNum + 1) / totalQuestions * 100) + '%';

            let html = `
                <div class="question-text">${q.question}</div>
                <div class="options-grid">
            `;

            q.options.forEach((opt, idx) => {
                html += `<button class="option-btn" onclick="checkAnswer(${idx})">${opt}</button>`;
            });

            html += '</div>';
            document.getElementById('game-content').innerHTML = html;
        }

        function checkAnswer(idx) {
            const q = questions[questionNum];
            const buttons = document.querySelectorAll('.option-btn');
            const selected = q.options[idx];
            const correct = q.correct;

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (q.options[i] === correct) {
                    btn.classList.add('correct');
                } else if (i === idx) {
                    btn.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                score++;
                document.getElementById('score').textContent = score;
            }

            questionNum++;
            setTimeout(nextQuestion, 1200);
        }

        function showResults() {
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';

            document.getElementById('final-score').textContent = `${score}/${totalQuestions}`;

            const percentage = (score / totalQuestions) * 100;
            let icon, title, message;

            if (percentage >= 90) {
                icon = 'üèÜ';
                title = 'Outstanding!';
                message = 'You\'re a chemistry genius!';
            } else if (percentage >= 70) {
                icon = 'üéâ';
                title = 'Great Job!';
                message = 'You really know your chemistry!';
            } else if (percentage >= 50) {
                icon = 'üëç';
                title = 'Good Effort!';
                message = 'Keep practicing to improve!';
            } else {
                icon = 'üìö';
                title = 'Keep Learning!';
                message = 'Review and try again - you\'ve got this!';
            }

            document.getElementById('results-icon').textContent = icon;
            document.getElementById('results-title').textContent = title;
            document.getElementById('results-message').textContent = message;

            lucide.createIcons();
        }

        function playAgain() {
            startGame(currentGame);
        }

        function backToGames() {
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'none';
            document.querySelector('.games-grid').style.display = 'grid';
        }

        function endGame() {
            if (confirm('Are you sure you want to exit the game?')) {
                backToGames();
            }
        }
    </script>
</body>

</html>