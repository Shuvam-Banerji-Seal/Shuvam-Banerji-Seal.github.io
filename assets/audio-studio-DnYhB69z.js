import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               *//* empty css                  */import"./navbar-CxcuK0N-.js";class R{constructor(){this.audioContext=null,this.mediaRecorder=null,this.audioBuffer=null,this.sourceNode=null,this.gainNode=null,this.analyser=null,this.isRecording=!1,this.isPlaying=!1,this.isTunerActive=!1,this.isLooping=!1,this.startTime=0,this.pauseTime=0,this.playbackRate=1,this.selection={start:0,end:0},this.hasSelection=!1,this.waveformData=null,this.zoom=1,this.scrollOffset=0,this.history=[],this.historyIndex=-1,this.maxHistory=50,this.clipboard=null,this.effects={eq:null,compressor:null,reverb:null,delay:null},this.recordedChunks=[],this.recordingStartTime=0,this.canvas=null,this.ctx=null,this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioContext.createGain(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.gainNode.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.setupEffectsChain(),this.bindEvents(),await this.populateInputDevices(),this.initializeCanvas(),console.log("Audio Studio initialized")}catch(e){console.error("Failed to initialize Audio Studio:",e)}}setupEffectsChain(){this.effects.eq={bands:[60,170,310,600,1e3,3e3,6e3,12e3,14e3,16e3].map(e=>{const t=this.audioContext.createBiquadFilter();return t.type="peaking",t.frequency.value=e,t.Q.value=1.5,t.gain.value=0,t}),enabled:!1},this.effects.compressor=this.audioContext.createDynamicsCompressor(),this.effects.compressor.threshold.value=-24,this.effects.compressor.ratio.value=4,this.effects.compressor.attack.value=.01,this.effects.compressor.release.value=.25,this.effects.delay={node:this.audioContext.createDelay(5),feedback:this.audioContext.createGain(),mix:this.audioContext.createGain(),enabled:!1},this.effects.delay.node.delayTime.value=.25,this.effects.delay.feedback.gain.value=.3,this.effects.delay.mix.gain.value=.25}async populateInputDevices(){try{await navigator.mediaDevices.getUserMedia({audio:!0});const t=(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="audioinput"),i=document.getElementById("audio-input-select");i&&(i.innerHTML='<option value="">Select Microphone...</option>',t.forEach(s=>{const a=document.createElement("option");a.value=s.deviceId,a.textContent=s.label||`Microphone ${i.options.length}`,i.appendChild(a)}),t.length>0&&(i.value=t[0].deviceId))}catch(e){console.error("Error accessing audio devices:",e)}}initializeCanvas(){this.canvas=document.getElementById("waveform-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()))}resizeCanvas(){if(!this.canvas)return;const e=this.canvas.parentElement,t=window.devicePixelRatio||1;this.canvas.width=e.clientWidth*t,this.canvas.height=(e.clientHeight-25)*t,this.canvas.style.width=e.clientWidth+"px",this.canvas.style.height=e.clientHeight-25+"px",this.ctx.scale(t,t),this.audioBuffer&&this.drawWaveform()}bindEvents(){var s,a,r,o,n,d,c,u,g,l,f,m,v,p,B,E,x,C,w,I,b,S,T,k,L,D,M;document.querySelectorAll(".source-tab").forEach(h=>{h.addEventListener("click",()=>this.switchSourceTab(h.dataset.source))});const e=document.getElementById("record-btn");e&&e.addEventListener("click",()=>this.toggleRecording());const t=document.getElementById("upload-zone"),i=document.getElementById("audio-file-input");t&&i&&(t.addEventListener("click",()=>i.click()),t.addEventListener("dragover",h=>{h.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",()=>t.classList.remove("dragover")),t.addEventListener("drop",h=>{h.preventDefault(),t.classList.remove("dragover");const y=h.dataTransfer.files[0];y&&y.type.startsWith("audio/")&&this.loadAudioFile(y)}),i.addEventListener("change",h=>{h.target.files[0]&&this.loadAudioFile(h.target.files[0])})),(s=document.getElementById("play-btn"))==null||s.addEventListener("click",()=>this.togglePlayback()),(a=document.getElementById("stop-btn"))==null||a.addEventListener("click",()=>this.stop()),(r=document.getElementById("skip-start-btn"))==null||r.addEventListener("click",()=>this.skipToStart()),(o=document.getElementById("skip-end-btn"))==null||o.addEventListener("click",()=>this.skipToEnd()),(n=document.getElementById("loop-btn"))==null||n.addEventListener("click",()=>this.toggleLoop()),(d=document.getElementById("zoom-in-btn"))==null||d.addEventListener("click",()=>this.zoomIn()),(c=document.getElementById("zoom-out-btn"))==null||c.addEventListener("click",()=>this.zoomOut()),(u=document.getElementById("zoom-slider"))==null||u.addEventListener("input",h=>{this.zoom=parseFloat(h.target.value)/10,this.drawWaveform()}),(g=document.getElementById("cut-btn"))==null||g.addEventListener("click",()=>this.cut()),(l=document.getElementById("copy-btn"))==null||l.addEventListener("click",()=>this.copy()),(f=document.getElementById("paste-btn"))==null||f.addEventListener("click",()=>this.paste()),(m=document.getElementById("delete-btn"))==null||m.addEventListener("click",()=>this.deleteSelection()),(v=document.getElementById("undo-btn"))==null||v.addEventListener("click",()=>this.undo()),(p=document.getElementById("redo-btn"))==null||p.addEventListener("click",()=>this.redo()),(B=document.getElementById("select-all-btn"))==null||B.addEventListener("click",()=>this.selectAll()),(E=document.getElementById("trim-btn"))==null||E.addEventListener("click",()=>this.trimToSelection()),(x=document.getElementById("split-btn"))==null||x.addEventListener("click",()=>this.split()),(C=document.getElementById("master-volume"))==null||C.addEventListener("input",h=>{const y=parseFloat(h.target.value)/100;this.gainNode.gain.value=y,document.getElementById("volume-value").textContent=h.target.value}),this.bindEffectControls(),(w=document.getElementById("export-btn"))==null||w.addEventListener("click",()=>this.exportAudio()),(I=document.getElementById("export-selection-btn"))==null||I.addEventListener("click",()=>this.exportSelection()),(b=document.getElementById("export-format"))==null||b.addEventListener("change",h=>{const y=document.getElementById("mp3-quality-group");y&&(y.style.display=h.target.value==="mp3"?"block":"none")}),(S=document.getElementById("tuner-toggle"))==null||S.addEventListener("click",()=>this.toggleTuner()),(T=document.getElementById("fade-in-btn"))==null||T.addEventListener("click",()=>this.applyFadeIn()),(k=document.getElementById("fade-out-btn"))==null||k.addEventListener("click",()=>this.applyFadeOut()),(L=document.getElementById("fade-duration"))==null||L.addEventListener("input",h=>{document.getElementById("fade-duration-val").textContent=(h.target.value/1e3).toFixed(1)+"s"}),(D=document.getElementById("apply-normalize"))==null||D.addEventListener("click",()=>this.normalize()),(M=document.getElementById("normalize-level"))==null||M.addEventListener("input",h=>{document.getElementById("normalize-level-val").textContent=h.target.value+" dB"}),document.querySelectorAll(".effect-expand").forEach(h=>{h.addEventListener("click",y=>{y.stopPropagation(),h.closest(".effect-card").classList.toggle("expanded")})}),this.canvas&&(this.canvas.addEventListener("mousedown",h=>this.handleWaveformMouseDown(h)),this.canvas.addEventListener("mousemove",h=>this.handleWaveformMouseMove(h)),this.canvas.addEventListener("mouseup",h=>this.handleWaveformMouseUp(h)),this.canvas.addEventListener("click",h=>this.handleWaveformClick(h))),document.addEventListener("keydown",h=>this.handleKeyboard(h))}bindEffectControls(){var t,i,s;["60","170","310","600","1k","3k","6k","12k","14k","16k"].forEach((a,r)=>{const o=document.getElementById(`eq-${a}`);o&&o.addEventListener("input",n=>{this.effects.eq.bands[r]&&(this.effects.eq.bands[r].gain.value=parseFloat(n.target.value))})}),[{id:"comp-threshold",param:"threshold",suffix:" dB"},{id:"comp-ratio",param:"ratio",suffix:":1"},{id:"comp-attack",param:"attack",suffix:" ms",scale:.001},{id:"comp-release",param:"release",suffix:" ms",scale:.001}].forEach(a=>{const r=document.getElementById(a.id);r&&r.addEventListener("input",o=>{const n=parseFloat(o.target.value),d=a.scale?n*a.scale:n;this.effects.compressor[a.param]&&(this.effects.compressor[a.param].value=d);const c=document.getElementById(`${a.id}-val`);c&&(c.textContent=n+a.suffix)})}),(t=document.getElementById("delay-time"))==null||t.addEventListener("input",a=>{this.effects.delay.node.delayTime.value=a.target.value/1e3,document.getElementById("delay-time-val").textContent=a.target.value+" ms"}),(i=document.getElementById("delay-feedback"))==null||i.addEventListener("input",a=>{this.effects.delay.feedback.gain.value=a.target.value/100,document.getElementById("delay-feedback-val").textContent=a.target.value+"%"}),(s=document.getElementById("delay-mix"))==null||s.addEventListener("input",a=>{this.effects.delay.mix.gain.value=a.target.value/100,document.getElementById("delay-mix-val").textContent=a.target.value+"%"})}switchSourceTab(e){var t,i;document.querySelectorAll(".source-tab").forEach(s=>s.classList.remove("active")),document.querySelectorAll(".source-panel").forEach(s=>s.classList.remove("active")),(t=document.querySelector(`[data-source="${e}"]`))==null||t.classList.add("active"),(i=document.getElementById(`${e}-panel`))==null||i.classList.add("active")}async toggleRecording(){this.isRecording?this.stopRecording():await this.startRecording()}async startRecording(){var e;try{const t=(e=document.getElementById("audio-input-select"))==null?void 0:e.value,i={audio:t?{deviceId:{exact:t}}:!0},s=await navigator.mediaDevices.getUserMedia(i),a=this.audioContext.createMediaStreamSource(s),r=this.audioContext.createAnalyser();r.fftSize=256,a.connect(r),this.monitorInputLevel(r),this.mediaRecorder=new MediaRecorder(s,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=n=>{n.data.size>0&&this.recordedChunks.push(n.data)},this.mediaRecorder.onstop=async()=>{s.getTracks().forEach(d=>d.stop());const n=new Blob(this.recordedChunks,{type:this.mediaRecorder.mimeType});await this.loadAudioBlob(n)},this.mediaRecorder.start(100),this.isRecording=!0,this.recordingStartTime=Date.now();const o=document.getElementById("record-btn");o&&o.classList.add("recording"),this.updateRecordingTime()}catch(t){console.error("Recording failed:",t),alert("Could not access microphone. Please check permissions.")}}stopRecording(){if(this.mediaRecorder&&this.isRecording){this.mediaRecorder.stop(),this.isRecording=!1;const e=document.getElementById("record-btn");e&&e.classList.remove("recording")}}monitorInputLevel(e){const t=new Uint8Array(e.frequencyBinCount),i=document.getElementById("input-meter"),s=()=>{if(!this.isRecording)return;e.getByteFrequencyData(t);const r=t.reduce((o,n)=>o+n)/t.length/255*100;i&&(i.style.width=r+"%"),requestAnimationFrame(s)};s()}updateRecordingTime(){const e=document.getElementById("record-time"),t=()=>{if(!this.isRecording)return;const i=Date.now()-this.recordingStartTime,s=Math.floor(i/36e5),a=Math.floor(i%36e5/6e4),r=Math.floor(i%6e4/1e3);e&&(e.textContent=`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`),requestAnimationFrame(t)};t()}async loadAudioFile(e){try{const t=await e.arrayBuffer();this.audioBuffer=await this.audioContext.decodeAudioData(t),this.saveToHistory(),this.showWaveform(),this.drawWaveform(),this.updateTimeDisplay()}catch(t){console.error("Error loading audio file:",t),alert("Could not load audio file. Please try a different format.")}}async loadAudioBlob(e){const t=await e.arrayBuffer();this.audioBuffer=await this.audioContext.decodeAudioData(t),this.saveToHistory(),this.showWaveform(),this.drawWaveform(),this.updateTimeDisplay()}showWaveform(){var e,t;(e=document.getElementById("waveform-placeholder"))==null||e.classList.add("hidden"),(t=document.getElementById("waveform-wrapper"))==null||t.classList.add("active")}drawWaveform(){if(!this.audioBuffer||!this.ctx)return;const e=this.canvas.width/(window.devicePixelRatio||1),t=this.canvas.height/(window.devicePixelRatio||1),i=this.audioBuffer.getChannelData(0);this.ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--bg-primary")||"#0a0a12",this.ctx.fillRect(0,0,e,t),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,t/2),this.ctx.lineTo(e,t/2),this.ctx.stroke();const s=Math.floor(i.length/(e*this.zoom)),a=this.ctx.createLinearGradient(0,0,0,t);a.addColorStop(0,"#06b6d4"),a.addColorStop(.5,"#8b5cf6"),a.addColorStop(1,"#06b6d4"),this.ctx.strokeStyle=a,this.ctx.lineWidth=1.5,this.ctx.beginPath(),e*this.zoom;const r=Math.floor(this.scrollOffset*i.length);for(let o=0;o<e;o++){const n=r+Math.floor(o*s);let d=1,c=-1;for(let l=0;l<s&&n+l<i.length;l++){const f=i[n+l];f<d&&(d=f),f>c&&(c=f)}const u=(1-d)*t/2,g=(1-c)*t/2;o===0&&this.ctx.moveTo(o,u),this.ctx.lineTo(o,u),this.ctx.lineTo(o,g)}if(this.ctx.stroke(),this.hasSelection){const o=this.selection.start/this.audioBuffer.duration*e,n=this.selection.end/this.audioBuffer.duration*e;this.ctx.fillStyle="rgba(6, 182, 212, 0.3)",this.ctx.fillRect(o,0,n-o,t),this.ctx.strokeStyle="#06b6d4",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(o,0),this.ctx.lineTo(o,t),this.ctx.moveTo(n,0),this.ctx.lineTo(n,t),this.ctx.stroke()}this.drawTimeRuler()}drawTimeRuler(){const e=document.getElementById("time-ruler");if(!e||!this.audioBuffer)return;const t=e.clientWidth,i=this.audioBuffer.duration;let s=1;i>60&&(s=10),i>300&&(s=30),i>600&&(s=60),e.innerHTML="";for(let a=0;a<i;a+=s){const r=a/i*t,o=document.createElement("div");o.className="ruler-tick",o.style.left=r+"px",o.textContent=this.formatTime(a),e.appendChild(o)}}formatTime(e,t=!1){const i=Math.floor(e/60),s=Math.floor(e%60),a=Math.floor(e%1*1e3);return t?`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}.${a.toString().padStart(3,"0")}`:`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}updateTimeDisplay(){this.audioBuffer&&(document.getElementById("current-time").textContent=this.formatTime(this.pauseTime,!0),document.getElementById("total-time").textContent=this.formatTime(this.audioBuffer.duration,!0))}togglePlayback(){this.isPlaying?this.pause():this.play()}play(){if(!this.audioBuffer)return;this.audioContext.state==="suspended"&&this.audioContext.resume(),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.audioBuffer,this.sourceNode.connect(this.gainNode),this.sourceNode.playbackRate.value=this.playbackRate,this.isLooping&&this.hasSelection&&(this.sourceNode.loop=!0,this.sourceNode.loopStart=this.selection.start,this.sourceNode.loopEnd=this.selection.end);const e=this.pauseTime;this.startTime=this.audioContext.currentTime-e,this.sourceNode.start(0,e),this.sourceNode.onended=()=>{this.isLooping||(this.isPlaying=!1,this.pauseTime=0,this.updatePlayButton(),this.updatePlayhead())},this.isPlaying=!0,this.updatePlayButton(),this.animatePlayhead()}pause(){!this.isPlaying||!this.sourceNode||(this.pauseTime=this.audioContext.currentTime-this.startTime,this.sourceNode.stop(),this.sourceNode.disconnect(),this.isPlaying=!1,this.updatePlayButton())}stop(){if(this.sourceNode){try{this.sourceNode.stop()}catch{}this.sourceNode.disconnect()}this.isPlaying=!1,this.pauseTime=0,this.updatePlayButton(),this.updatePlayhead(),this.updateTimeDisplay()}skipToStart(){this.pauseTime=0,this.isPlaying?(this.sourceNode.stop(),this.play()):(this.updatePlayhead(),this.updateTimeDisplay())}skipToEnd(){this.audioBuffer&&(this.pauseTime=this.audioBuffer.duration,this.isPlaying&&this.sourceNode.stop(),this.updatePlayhead(),this.updateTimeDisplay())}toggleLoop(){this.isLooping=!this.isLooping;const e=document.getElementById("loop-btn");e&&e.classList.toggle("active",this.isLooping)}updatePlayButton(){const e=document.getElementById("play-btn");e&&e.classList.toggle("playing",this.isPlaying)}updatePlayhead(){if(!this.audioBuffer)return;const e=document.getElementById("playhead"),t=document.getElementById("waveform-wrapper");if(!e||!t)return;const s=this.pauseTime/this.audioBuffer.duration*t.clientWidth;e.style.left=s+"px"}animatePlayhead(){if(!this.isPlaying)return;const e=this.audioContext.currentTime-this.startTime;this.pauseTime=e,this.updatePlayhead(),this.updateTimeDisplay(),requestAnimationFrame(()=>this.animatePlayhead())}zoomIn(){this.zoom=Math.min(this.zoom*1.5,10),document.getElementById("zoom-slider").value=this.zoom*10,this.drawWaveform()}zoomOut(){this.zoom=Math.max(this.zoom/1.5,1),document.getElementById("zoom-slider").value=this.zoom*10,this.drawWaveform()}handleWaveformClick(e){if(!this.audioBuffer)return;const t=this.canvas.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;this.pauseTime=s*this.audioBuffer.duration,this.updatePlayhead(),this.updateTimeDisplay()}handleWaveformMouseDown(e){if(!this.audioBuffer)return;this.isSelecting=!0;const t=this.canvas.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;this.selection.start=s*this.audioBuffer.duration,this.selection.end=this.selection.start}handleWaveformMouseMove(e){if(!this.isSelecting||!this.audioBuffer)return;const t=this.canvas.getBoundingClientRect(),s=Math.max(0,Math.min(e.clientX-t.left,t.width))/t.width;this.selection.end=s*this.audioBuffer.duration,this.hasSelection=Math.abs(this.selection.end-this.selection.start)>.01,this.drawWaveform(),this.updateSelectionInfo()}handleWaveformMouseUp(){this.isSelecting=!1,this.selection.start>this.selection.end&&([this.selection.start,this.selection.end]=[this.selection.end,this.selection.start])}updateSelectionInfo(){const e=document.getElementById("selection-info");e&&(this.hasSelection?(e.style.display="flex",document.getElementById("selection-start").textContent=this.formatTime(this.selection.start,!0),document.getElementById("selection-end").textContent=this.formatTime(this.selection.end,!0),document.getElementById("selection-duration").textContent=(this.selection.end-this.selection.start).toFixed(3)):e.style.display="none")}saveToHistory(){if(!this.audioBuffer)return;this.history=this.history.slice(0,this.historyIndex+1);const e=this.copyBuffer(this.audioBuffer);this.history.push(e),this.history.length>this.maxHistory&&this.history.shift(),this.historyIndex=this.history.length-1}copyBuffer(e){const t=this.audioContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let i=0;i<e.numberOfChannels;i++){const s=e.getChannelData(i);t.copyToChannel(new Float32Array(s),i)}return t}undo(){this.historyIndex<=0||(this.historyIndex--,this.audioBuffer=this.copyBuffer(this.history[this.historyIndex]),this.drawWaveform(),this.updateTimeDisplay())}redo(){this.historyIndex>=this.history.length-1||(this.historyIndex++,this.audioBuffer=this.copyBuffer(this.history[this.historyIndex]),this.drawWaveform(),this.updateTimeDisplay())}selectAll(){this.audioBuffer&&(this.selection.start=0,this.selection.end=this.audioBuffer.duration,this.hasSelection=!0,this.drawWaveform(),this.updateSelectionInfo())}cut(){!this.hasSelection||!this.audioBuffer||(this.copy(),this.deleteSelection())}copy(){if(!this.hasSelection||!this.audioBuffer)return;const e=Math.floor(this.selection.start*this.audioBuffer.sampleRate),i=Math.floor(this.selection.end*this.audioBuffer.sampleRate)-e;this.clipboard=this.audioContext.createBuffer(this.audioBuffer.numberOfChannels,i,this.audioBuffer.sampleRate);for(let s=0;s<this.audioBuffer.numberOfChannels;s++){const a=this.audioBuffer.getChannelData(s),r=this.clipboard.getChannelData(s);for(let o=0;o<i;o++)r[o]=a[e+o]}}paste(){if(!this.clipboard||!this.audioBuffer)return;const e=Math.floor(this.pauseTime*this.audioBuffer.sampleRate),t=this.audioBuffer.length+this.clipboard.length,i=this.audioContext.createBuffer(this.audioBuffer.numberOfChannels,t,this.audioBuffer.sampleRate);for(let s=0;s<this.audioBuffer.numberOfChannels;s++){const a=this.audioBuffer.getChannelData(s),r=this.clipboard.getChannelData(s),o=i.getChannelData(s);for(let n=0;n<e;n++)o[n]=a[n];for(let n=0;n<this.clipboard.length;n++)o[e+n]=r[n];for(let n=e;n<this.audioBuffer.length;n++)o[this.clipboard.length+n]=a[n]}this.audioBuffer=i,this.saveToHistory(),this.drawWaveform(),this.updateTimeDisplay()}deleteSelection(){if(!this.hasSelection||!this.audioBuffer)return;const e=Math.floor(this.selection.start*this.audioBuffer.sampleRate),t=Math.floor(this.selection.end*this.audioBuffer.sampleRate),i=this.audioBuffer.length-(t-e),s=this.audioContext.createBuffer(this.audioBuffer.numberOfChannels,i,this.audioBuffer.sampleRate);for(let a=0;a<this.audioBuffer.numberOfChannels;a++){const r=this.audioBuffer.getChannelData(a),o=s.getChannelData(a);let n=0;for(let d=0;d<this.audioBuffer.length;d++)(d<e||d>=t)&&(o[n++]=r[d])}this.audioBuffer=s,this.hasSelection=!1,this.saveToHistory(),this.drawWaveform(),this.updateTimeDisplay(),this.updateSelectionInfo()}trimToSelection(){if(!this.hasSelection||!this.audioBuffer)return;const e=Math.floor(this.selection.start*this.audioBuffer.sampleRate),i=Math.floor(this.selection.end*this.audioBuffer.sampleRate)-e,s=this.audioContext.createBuffer(this.audioBuffer.numberOfChannels,i,this.audioBuffer.sampleRate);for(let a=0;a<this.audioBuffer.numberOfChannels;a++){const r=this.audioBuffer.getChannelData(a),o=s.getChannelData(a);for(let n=0;n<i;n++)o[n]=r[e+n]}this.audioBuffer=s,this.hasSelection=!1,this.pauseTime=0,this.saveToHistory(),this.drawWaveform(),this.updateTimeDisplay(),this.updateSelectionInfo()}split(){console.log("Split at",this.pauseTime)}applyFadeIn(){var a,r;if(!this.audioBuffer)return;const e=parseInt(((a=document.getElementById("fade-duration"))==null?void 0:a.value)||1e3)/1e3,t=((r=document.getElementById("fade-curve"))==null?void 0:r.value)||"linear",i=this.hasSelection?Math.floor(this.selection.start*this.audioBuffer.sampleRate):0,s=Math.floor(e*this.audioBuffer.sampleRate);for(let o=0;o<this.audioBuffer.numberOfChannels;o++){const n=this.audioBuffer.getChannelData(o);for(let d=0;d<s&&i+d<n.length;d++){let c=d/s;t==="exponential"?c=Math.pow(c,2):t==="logarithmic"?c=Math.sqrt(c):t==="scurve"&&(c=(1-Math.cos(c*Math.PI))/2),n[i+d]*=c}}this.saveToHistory(),this.drawWaveform()}applyFadeOut(){var r,o;if(!this.audioBuffer)return;const e=parseInt(((r=document.getElementById("fade-duration"))==null?void 0:r.value)||1e3)/1e3,t=((o=document.getElementById("fade-curve"))==null?void 0:o.value)||"linear",i=this.hasSelection?Math.floor(this.selection.end*this.audioBuffer.sampleRate):this.audioBuffer.length,s=Math.floor(e*this.audioBuffer.sampleRate),a=i-s;for(let n=0;n<this.audioBuffer.numberOfChannels;n++){const d=this.audioBuffer.getChannelData(n);for(let c=0;c<s;c++){let u=1-c/s;t==="exponential"?u=Math.pow(u,2):t==="logarithmic"?u=Math.sqrt(u):t==="scurve"&&(u=(1+Math.cos((1-u)*Math.PI))/2),a+c>=0&&(d[a+c]*=u)}}this.saveToHistory(),this.drawWaveform()}normalize(){var a;if(!this.audioBuffer)return;const e=parseFloat(((a=document.getElementById("normalize-level"))==null?void 0:a.value)||-1),t=Math.pow(10,e/20);let i=0;for(let r=0;r<this.audioBuffer.numberOfChannels;r++){const o=this.audioBuffer.getChannelData(r);for(let n=0;n<o.length;n++)i=Math.max(i,Math.abs(o[n]))}if(i===0)return;const s=t/i;for(let r=0;r<this.audioBuffer.numberOfChannels;r++){const o=this.audioBuffer.getChannelData(r);for(let n=0;n<o.length;n++)o[n]*=s}this.saveToHistory(),this.drawWaveform()}async toggleTuner(){this.isTunerActive?this.stopTuner():await this.startTuner()}async startTuner(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=this.audioContext.createMediaStreamSource(e),i=this.audioContext.createAnalyser();i.fftSize=4096,t.connect(i),this.tunerStream=e,this.tunerAnalyser=i,this.isTunerActive=!0,document.getElementById("tuner-toggle").innerHTML='<i data-lucide="radio"></i> Stop Tuner',lucide.createIcons(),this.runTuner()}catch(e){console.error("Tuner error:",e)}}stopTuner(){this.tunerStream&&this.tunerStream.getTracks().forEach(e=>e.stop()),this.isTunerActive=!1,document.getElementById("tuner-toggle").innerHTML='<i data-lucide="radio"></i> Start Tuner',document.getElementById("tuner-note").textContent="--",document.getElementById("tuner-freq").textContent="-- Hz",document.getElementById("tuner-needle").style.left="50%",lucide.createIcons()}runTuner(){if(!this.isTunerActive)return;const e=new Float32Array(this.tunerAnalyser.fftSize);this.tunerAnalyser.getFloatTimeDomainData(e);const t=this.autoCorrelate(e,this.audioContext.sampleRate);if(t>0){const i=this.getNoteFromFrequency(t);document.getElementById("tuner-note").textContent=i.note,document.getElementById("tuner-freq").textContent=t.toFixed(1)+" Hz";const a=50+i.cents/50*45;document.getElementById("tuner-needle").style.left=a+"%"}requestAnimationFrame(()=>this.runTuner())}autoCorrelate(e,t){let i=e.length,s=0;for(let l=0;l<i;l++)s+=e[l]*e[l];if(s=Math.sqrt(s/i),s<.01)return-1;let a=0,r=i-1;const o=.2;for(let l=0;l<i/2;l++)if(Math.abs(e[l])<o){a=l;break}for(let l=1;l<i/2;l++)if(Math.abs(e[i-l])<o){r=i-l;break}e=e.slice(a,r),i=e.length;const n=new Array(i).fill(0);for(let l=0;l<i;l++)for(let f=0;f<i-l;f++)n[l]+=e[f]*e[f+l];let d=0;for(;n[d]>n[d+1];)d++;let c=-1,u=-1;for(let l=d;l<i;l++)n[l]>c&&(c=n[l],u=l);return t/u}getNoteFromFrequency(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=12*(Math.log(e/440)/Math.log(2)),s=Math.round(i)+69,a=t[s%12],r=Math.floor(s/12)-1,o=Math.round((i-Math.round(i))*100);return{note:a+r,cents:o}}async exportAudio(){var t,i;if(!this.audioBuffer)return;const e=((t=document.getElementById("export-format"))==null?void 0:t.value)||"wav";parseInt(((i=document.getElementById("sample-rate"))==null?void 0:i.value)||44100),this.showProcessingModal("Exporting audio...");try{let s;e==="wav"?s=this.audioBufferToWav(this.audioBuffer):s=await this.encodeWithMediaRecorder(e);const a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`audio_export.${e==="wav"?"wav":e}`,r.click(),URL.revokeObjectURL(a)}catch(s){console.error("Export error:",s),alert("Export failed: "+s.message)}this.hideProcessingModal()}exportSelection(){if(!this.hasSelection||!this.audioBuffer){alert("Please make a selection first");return}const e=Math.floor(this.selection.start*this.audioBuffer.sampleRate),i=Math.floor(this.selection.end*this.audioBuffer.sampleRate)-e,s=this.audioContext.createBuffer(this.audioBuffer.numberOfChannels,i,this.audioBuffer.sampleRate);for(let n=0;n<this.audioBuffer.numberOfChannels;n++){const d=this.audioBuffer.getChannelData(n),c=s.getChannelData(n);for(let u=0;u<i;u++)c[u]=d[e+u]}const a=this.audioBufferToWav(s),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download="selection.wav",o.click(),URL.revokeObjectURL(r)}audioBufferToWav(e){const t=e.numberOfChannels,i=e.sampleRate,s=1,a=16,r=a/8,o=t*r,n=e.length*o,d=44+n,c=new ArrayBuffer(d),u=new DataView(c),g=(m,v)=>{for(let p=0;p<v.length;p++)u.setUint8(m+p,v.charCodeAt(p))};g(0,"RIFF"),u.setUint32(4,d-8,!0),g(8,"WAVE"),g(12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,s,!0),u.setUint16(22,t,!0),u.setUint32(24,i,!0),u.setUint32(28,i*o,!0),u.setUint16(32,o,!0),u.setUint16(34,a,!0),g(36,"data"),u.setUint32(40,n,!0);const l=[];for(let m=0;m<t;m++)l.push(e.getChannelData(m));let f=44;for(let m=0;m<e.length;m++)for(let v=0;v<t;v++){const p=Math.max(-1,Math.min(1,l[v][m])),B=p<0?p*32768:p*32767;u.setInt16(f,B,!0),f+=2}return new Blob([c],{type:"audio/wav"})}async encodeWithMediaRecorder(e){return new Promise((t,i)=>{const s=new OfflineAudioContext(this.audioBuffer.numberOfChannels,this.audioBuffer.length,this.audioBuffer.sampleRate),a=s.createBufferSource();a.buffer=this.audioBuffer;const r=s.createMediaStreamDestination();a.connect(r),a.start();const o=e==="mp3"?"audio/webm":`audio/${e}`,n=new MediaRecorder(r.stream,{mimeType:o}),d=[];n.ondataavailable=c=>d.push(c.data),n.onstop=()=>t(new Blob(d,{type:o})),n.onerror=c=>i(c),n.start(),s.startRendering().then(()=>{setTimeout(()=>n.stop(),100)})})}showProcessingModal(e){const t=document.getElementById("processing-modal"),i=document.getElementById("processing-title");t&&t.classList.add("show"),i&&(i.textContent=e)}hideProcessingModal(){const e=document.getElementById("processing-modal");e&&e.classList.remove("show")}handleKeyboard(e){if(!(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"))if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"z":e.preventDefault(),e.shiftKey?this.redo():this.undo();break;case"y":e.preventDefault(),this.redo();break;case"x":e.preventDefault(),this.cut();break;case"c":e.preventDefault(),this.copy();break;case"v":e.preventDefault(),this.paste();break;case"a":e.preventDefault(),this.selectAll();break;case"s":e.preventDefault(),this.exportAudio();break}else switch(e.key){case" ":e.preventDefault(),this.togglePlayback();break;case"Delete":case"Backspace":this.deleteSelection();break;case"Home":this.skipToStart();break;case"End":this.skipToEnd();break;case"l":this.toggleLoop();break}}}document.addEventListener("DOMContentLoaded",()=>{window.audioStudio=new R});
